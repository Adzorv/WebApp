<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <head th:insert="fragments/head :: head">
    </head>
    <title>Registratie</title>
</head>
<body>
<div th:insert="fragments/navigation :: navigation"></div>
<main class="wrap">
    <h1>Registreren</h1>
    <h2>Vul het registratie formulier in</h2>
    <form method="post" th:action="@{registration}" th:object="${registrationForm}">
        <table class="loginform">
            <tr>* verplicht</tr>
            <tr>
                <td>Voornaam*:</td>
                <td><input type="text" name="input_firstName" th:field="*{firstName}" placeholder="Voornaam"
                           pattern="[A-Za-z ]{1,}" required></td>
            </tr>
            <tr>
                <td>Tussenvoegsel:</td>
                <td><input type="text" name="input_prefix" th:field="*{prefix}" placeholder="Tussenvoegsel"
                           pattern="[A-Za-z ]{1,}"></td>
            </tr>
            <tr>
                <td>Achternaam*:</td>
                <td><input type="text" name="input_lastName" th:field="*{lastName}" placeholder="Achternaam"
                           pattern="[A-Za-z ]{1,}" required ></td>
            </tr>
            <tr>
                <td>Telefoon*:</td>
                <td><input type="text" name="input_phoneNumber" th:field="*{phoneNumber}" placeholder="0612345678"
                           pattern="[0-9 +]{8,}" required ></td>
            </tr>
            <tr>
                <td>Postcode*:</td>
                <td><input type="text" id="postcode" name="input_post_code" th:field="*{postCode}" placeholder="0000XX"
                           pattern="[0-9]{4}[A-Za-z]{2}" required ></td>
            </tr>
            <tr>
                <td>Huisnummer*:</td>
                <td><input type="text" id="housenumber" name="input_houseNumber" th:field="*{houseNumber}" placeholder="000"
                           pattern="[0-9]{1,}" required > </td>
            </tr>
            <tr>
                <td>Straat*:</td>
                <td><input type="text" id="street" name="input_streetName" th:field="*{streetName}" placeholder="Straatnaam"
                           required></td>
            </tr>
            <tr>
                <td>Toevoeging:</td>
                <td><input type="text" name="input_house_number_annex" th:field="*{houseNumberAnnex}"
                           placeholder="Toevoeging"></td>
            </tr>
            <tr>
                <td> Woonplaats*:</td>
                <td><input type="text" id="city" name="input_city" th:field="*{city}" placeholder="Woonplaats"
                           pattern="[A-Za-z ]{1,}" required ></td>
            </tr>
            <tr>
                <td>Email*:</td>
                <td><input type="text" name="input_email" th:field="*{email}" placeholder="naam@email.com"
                           pattern="\b[A-Za-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}\b" required ></td>
            </tr>
            <tr>
                <td>Geboortedatum*:</td>
                <td><input type="date" name="input_birth_date" th:field="*{birthDate}" required ></td>
            </tr>
            <tr>
                <td>BSN*:</td>
                <td><input type="text" name="bsn" th:field="*{bsn}" placeholder="111222333" required ></td>
                <td class="error"><span th:text="${bsnError}"></span></td>
            </tr>
            <tr>
                <td><input class="button_bottom" type="submit" name="register" value="Registreer"/></td>
            </tr>
        </table>
    </form>


    <script>
        var leaveStreetinputEvent = document.getElementById("housenumber").addEventListener('blur', getStreetFromSite);
    function getStreetFromSite(){
        var postcode = document.getElementById("postcode").value;
        var huisnummer = document.getElementById("housenumber").value;

        const url = `https://postcode.tech/api/v1/postcode?postcode=${postcode}&number=${huisnummer}`;

        var request = new XMLHttpRequest();
        request.open('GET', url, true);
        request.setRequestHeader('Authorization', 'Bearer 05f0f3b1-dc8c-494d-aa48-449b5c906bfd')
        request.setRequestHeader('Content-Type', 'application/json'); // x-www-urlencoded
        request.setRequestHeader('Accept', 'application/json');
        request.send();

        request.onreadystatechange = function() {
            if(request.readyState === XMLHttpRequest.DONE){
                if(request.status === 200){
                    console.log(request.response);
                    var responseObject = JSON.parse(request.response);
                    var street = responseObject.street;
                    console.log(street);
                    document.getElementById("street").value = responseObject.street;
                    document.getElementById("city").value = responseObject.city;
                } else {
                console.log("iets ging fout: status " + request.status + " " + request.statusText);
                }
            }
       }
    }
    </script>

    <div th:insert="fragments/footer :: footer"></div>
</main>
</body>
</html>